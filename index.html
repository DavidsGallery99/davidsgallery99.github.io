<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>David — Photography</title>
  <meta name="description" content="Vienna-based photographer. City, people, and landscape photography." />
  <meta name="robots" content="index,follow" />
  <meta name="theme-color" content="#0a0b0d" />
  <link rel="icon" href="images/favicon.ico" />

  <style>
    /* -------- Fixed (dark) theme -------- */
    :root{
      --bg:#0a0b0d;
      --text:#e9eaee;
      --muted:#a8acb7;
      --panel:#121318;
      --panel-2:#161821;
      --accent:#93c6ff;
      --focus:#ffd78e;
      --border:1px solid rgba(255,255,255,.06);
      --radius:14px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{margin:0; background:var(--bg); color:var(--text); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    :focus-visible{outline:3px solid var(--focus); outline-offset:6px; border-radius:10px}

    /* -------- Full-bleed Masonry Gallery -------- */
    main{min-height:100dvh}
    .grid{
      column-gap:0;           /* no gaps, full-bleed rows */
      line-height:0;          /* remove whitespace between inline-block images */
      width:100vw;            /* edge to edge */
    }
    /* responsive column counts */
    @media (min-width:1500px){ .grid{ column-count:6 } }
    @media (min-width:1200px) and (max-width:1499px){ .grid{ column-count:5 } }
    @media (min-width:900px)  and (max-width:1199px){ .grid{ column-count:4 } }
    @media (min-width:640px)  and (max-width:899px) { .grid{ column-count:3 } }
    @media (max-width:639px){  .grid{ column-count:2 } }

    .tile{
      display:inline-block;   /* required for masonry */
      width:100%;
      break-inside:avoid;     /* keep each image intact */
      position:relative;
    }
    .tile a{ display:block; text-decoration:none; color:inherit; }
    .tile img{
      width:100%; height:auto; display:block;
      background:#0f1116;     /* subtle background while loading */
      transition:filter .2s ease, transform .35s ease;
      filter:saturate(1.02) contrast(1.02);
    }
    .tile:hover img{ transform:scale(1.01) }

    /* -------- Minimal overlay controls -------- */
    .fab{
      position:fixed; right:16px; bottom:16px; z-index:50;
      width:46px; height:46px; border-radius:50%;
      display:inline-flex; align-items:center; justify-content:center;
      background:var(--panel); color:var(--text);
      border:var(--border); box-shadow:var(--shadow);
      cursor:pointer; user-select:none;
    }
    .drawer{
      position:fixed; inset:0 0 0 auto; width:min(360px,88vw);
      transform:translateX(100%); transition:.25s ease transform;
      background:var(--panel-2); border-left:var(--border); z-index:60; padding:18px;
    }
    .drawer.open{ transform:none }
    .drawer h3{ margin:0 0 6px 0 }
    .drawer a{ display:block; padding:10px 0; color:var(--text); text-decoration:none; border-bottom:1px dashed #3336 }
    .drawer p{ color:var(--muted) }
    .drawer .close{
      position:absolute; top:10px; right:10px; width:40px; height:40px; border-radius:50%;
      border:var(--border); background:#000a; color:#fff; cursor:pointer;
    }

    /* -------- Lightbox -------- */
    dialog.lightbox{width:min(1600px,94vw); border:none; padding:0; background:transparent; }
    dialog::backdrop{background:rgba(0,0,0,.85)}
    .lightbox figure{margin:0; position:relative}
    .lightbox img{width:100%; height:auto; display:block; border-radius:12px}
    .lightbox .close{position:absolute; top:10px; right:10px; background:#000a; color:#fff; border:none; border-radius:999px; width:40px; height:40px; font-size:18px; cursor:pointer}
  </style>
</head>
<body>
  <!-- Minimal floating menu (not distracting) -->
  <button class="fab" id="menuBtn" aria-controls="drawer" aria-expanded="false" title="Menu">≡</button>
  <aside class="drawer" id="drawer" aria-hidden="true">
    <button class="close" onclick="toggleDrawer(false)" aria-label="Close">✕</button>
    <h3>David — Photography</h3>
    <p>Vienna • Portraits • Street • Landscape</p>
    <a href="mailto:you@example.com">Contact</a>
    <a href="https://www.instagram.com/davidsgallery99/" target="_blank" rel="noopener">Instagram</a>
    <a href="https://davidsgallery99.github.io" target="_blank" rel="noopener">Website</a>
    <p style="margin-top:12px; color:#777">© <span id="year"></span> David</p>
  </aside>

  <!-- IMAGE-ONLY HOMEPAGE -->
  <main>
    <div class="grid" id="grid" aria-label="Photo gallery"></div>
  </main>

  <!-- Lightbox -->
  <dialog class="lightbox" id="lightbox">
    <figure>
      <img id="lightImg" alt="">
      <button class="close" onclick="closeLightbox()" aria-label="Close">✕</button>
    </figure>
  </dialog>

  <script>
    // ---------- Repo info for auto-loading your folders ----------
    const GH_USER = "davidsgallery99";             // change if needed
    const GH_REPO = "davidsgallery99.github.io";   // change if needed
    const BRANCH  = "main";                        // or "gh-pages"

    // ---------- Minimal menu ----------
    const drawer = document.getElementById('drawer');
    const btn = document.getElementById('menuBtn');
    function toggleDrawer(force){
      const open = typeof force==='boolean' ? force : !drawer.classList.contains('open');
      drawer.classList.toggle('open', open);
      drawer.setAttribute('aria-hidden', String(!open));
      btn.setAttribute('aria-expanded', String(open));
    }
    btn.addEventListener('click', ()=>toggleDrawer());

    // ---------- Helpers ----------
    const grid = document.getElementById('grid');
    const categories = ['city','people','nature'];
    const exts = ['.jpg','.jpeg','.png','.webp','.avif','.JPG','.JPEG','.PNG','.WEBP','.AVIF'];
    const enc = s => s.split('/').map(encodeURIComponent).join('/');
    function isImage(name){ return exts.some(e => name.endsWith(e)); }

    async function listDir(path){
      const url = `https://api.github.com/repos/${GH_USER}/${GH_REPO}/contents/${enc(path)}?ref=${encodeURIComponent(BRANCH)}`;
      const res = await fetch(url, {headers:{'Accept':'application/vnd.github+json'}});
      if(!res.ok) throw new Error(`GitHub API ${res.status} for ${path}`);
      return res.json();
    }

    function makeTile(cat, filename){
      const large = `images/large/${cat}/${filename}`;
      const thumb = `images/thumbs/${cat}/${filename}`;

      const a = document.createElement('a');
      a.href = large;
      a.className = 'tile';
      a.dataset.tags = cat;

      const img = document.createElement('img');
      img.alt = `${cat} photo`;
      img.loading = 'lazy';
      img.decoding = 'async';

      // Sharp by default; thumb only as a smaller candidate
      img.src = large;
      img.srcset = `${thumb} 600w, ${large} 1800w`;
      img.sizes = '100vw';

      // If thumb missing, keep large (no pixelation)
      img.addEventListener('error', e => {
        if (e.target.currentSrc.includes('/thumbs/')) e.target.src = large;
      }, {once:true});

      a.appendChild(img);
      return a;
    }

    (async function build(){
      // Load and append every image from thumbs/* (mirrors to large/*)
      const lists = await Promise.all(categories.map(cat => listDir(`images/thumbs/${cat}`).catch(()=>[])));
      const items = [];
      lists.forEach((arr, i)=>{
        const cat = categories[i];
        (arr||[]).filter(x => x.type==='file' && isImage(x.name)).forEach(x => items.push({cat, filename:x.name}));
      });

      // Order: interleave categories for variety
      items.sort((a,b)=> a.filename.localeCompare(b.filename));

      // Append all as masonry tiles
      items.forEach(it => grid.appendChild(makeTile(it.cat, it.filename)));
    })().catch(err=>{
      console.error(err);
      // If listing fails, keep page clean
      grid.innerHTML = "";
    });

    // ---------- Lightbox ----------
    const dlg=document.getElementById('lightbox');
    const lightImg=document.getElementById('lightImg');
    grid.addEventListener('click', e=>{
      const a = e.target.closest('a.tile');
      if(!a) return;
      e.preventDefault();
      lightImg.src = a.href;
      lightImg.alt = a.querySelector('img')?.alt || '';
      dlg.showModal();
    });
    function closeLightbox(){ dlg.close(); }
    window.closeLightbox = closeLightbox;

    // ---------- Year ----------
    document.getElementById('year')?.appendChild(document.createTextNode(new Date().getFullYear()));
  </script>
</body>
</html>
